<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Artjoms Šinkarovs">
  <meta name="dcterms.date" content="2020-09-01">
  <title>Multi-dimensional Arrays with Levels</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reset.css">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/white.css" id="theme">
  <link rel="stylesheet" href="Agda.css"/>
  <link rel="stylesheet" href="my.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Multi-dimensional Arrays with Levels</h1>
  <p class="subtitle">MSFP 2020</p>
  <p class="author">Artjoms Šinkarovs</p>
  <p class="date">01 September 2020</p>
</section>

<section id="agenda" class="title-slide slide level1">
<h1>Agenda</h1>
<ul>
<li>Formalising arrays in a dependently-typed context</li>
<li>Containers
<ul>
<li>discovering a new container operation</li>
<li>discovering array hierarchies</li>
</ul></li>
<li>Practical application</li>
</ul>
</section>

<section id="formalising-arrays" class="title-slide slide level1">
<h1>Formalising Arrays</h1>
<p>Key features we would like to have in the model:</p>
<ul>
<li>Rank polymorphism</li>
<li>Static bounds checking</li>
<li>Can represent any APL operator</li>
<li>Extendable [optional]</li>
</ul>
</section>

<section>
<section id="formalising-arrays-1" class="title-slide slide level1">
<h1>Formalising Arrays</h1>
<p>Static bounds checking and the ability to encode operations such as <code>take</code> or <code>drop</code> suggests that arrays should be dependently-typed.</p>
<div class="fragment">
<p>Here is a type for an <span class="math inline"><em>n</em></span>-dimensional array.</p>
<!--
<pre class="Agda"><a id="786" class="Symbol">{-#</a> <a id="790" class="Keyword">OPTIONS</a> <a id="798" class="Pragma">--rewriting</a> <a id="810" class="Symbol">#-}</a>
<a id="814" class="Keyword">module</a> <a id="821" href="present.html" class="Module">_</a> <a id="823" class="Keyword">where</a>
<a id="829" class="Keyword">open</a> <a id="834" class="Keyword">import</a> <a id="841" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="850" class="Keyword">using</a> <a id="856" class="Symbol">(</a><a id="857" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="858" class="Symbol">;</a> <a id="860" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a><a id="863" class="Symbol">;</a> <a id="865" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="869" class="Symbol">;</a> <a id="871" href="Agda.Builtin.Nat.html#501" class="Primitive Operator">_*_</a><a id="874" class="Symbol">;</a> <a id="876" href="Agda.Builtin.Nat.html#298" class="Primitive Operator">_+_</a><a id="879" class="Symbol">)</a>
<a id="881" class="Keyword">open</a> <a id="886" class="Keyword">import</a> <a id="893" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="902" class="Keyword">using</a> <a id="908" class="Symbol">(</a><a id="909" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="912" class="Symbol">;</a> <a id="914" href="Data.Fin.Base.html#1114" class="InductiveConstructor">suc</a><a id="917" class="Symbol">;</a> <a id="919" href="Data.Fin.Base.html#1083" class="InductiveConstructor">zero</a><a id="923" class="Symbol">)</a>
<a id="925" class="Keyword">open</a> <a id="930" class="Keyword">import</a> <a id="937" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="946" class="Keyword">using</a> <a id="952" class="Symbol">(</a><a id="953" href="Data.Vec.Base.html#935" class="Datatype">Vec</a><a id="956" class="Symbol">;</a> <a id="958" href="Data.Vec.Base.html#971" class="InductiveConstructor">[]</a><a id="960" class="Symbol">;</a> <a id="962" href="Data.Vec.Base.html#990" class="InductiveConstructor Operator">_∷_</a><a id="965" class="Symbol">;</a> <a id="967" href="Data.Vec.Base.html#1491" class="Function">lookup</a><a id="973" class="Symbol">;</a> <a id="975" href="Data.Vec.Base.html#4641" class="Function">foldr</a><a id="980" class="Symbol">)</a>
<a id="982" class="Keyword">open</a> <a id="987" class="Keyword">import</a> <a id="994" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
<a id="1032" class="Keyword">open</a> <a id="1037" class="Keyword">import</a> <a id="1044" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="1054" class="Keyword">open</a> <a id="1059" class="Keyword">import</a> <a id="1066" href="Data.Product.html" class="Module">Data.Product</a> <a id="1079" class="Keyword">hiding</a> <a id="1086" class="Symbol">(</a><a id="1087" href="Data.Product.html#2435" class="Function">map</a><a id="1090" class="Symbol">)</a>
<a id="1092" class="Keyword">open</a> <a id="1097" class="Keyword">import</a> <a id="1104" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="1113" class="Keyword">hiding</a> <a id="1120" class="Symbol">(</a><a id="1121" href="Data.Sum.Base.html#1203" class="Function">map</a><a id="1124" class="Symbol">)</a>
<a id="1126" class="Keyword">open</a> <a id="1131" class="Keyword">import</a> <a id="1138" href="Function.html" class="Module">Function</a>
<a id="1147" class="Comment">--infixr 5 _∷_</a>


<a id="1164" class="Keyword">module</a> <a id="1171" href="present.html#1171" class="Module">_</a> <a id="1173" class="Keyword">where</a>
</pre>-->
<pre class="Agda">  <a id="1197" class="Keyword">data</a> <a id="1202" href="present.html#1202" class="Datatype">Ix</a> <a id="1205" class="Symbol">:</a> <a id="1207" class="Symbol">(</a><a id="1208" href="present.html#1208" class="Bound">d</a> <a id="1210" class="Symbol">:</a> <a id="1212" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="1213" class="Symbol">)</a> <a id="1215" class="Symbol">→</a> <a id="1217" class="Symbol">(</a><a id="1218" href="present.html#1218" class="Bound">s</a> <a id="1220" class="Symbol">:</a> <a id="1222" href="Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="1226" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1228" href="present.html#1208" class="Bound">d</a><a id="1229" class="Symbol">)</a> <a id="1231" class="Symbol">→</a> <a id="1233" class="PrimitiveType">Set</a> <a id="1237" class="Keyword">where</a>
    <a id="1247" href="present.html#1247" class="InductiveConstructor">[]</a>   <a id="1252" class="Symbol">:</a> <a id="1254" href="present.html#1202" class="Datatype">Ix</a> <a id="1257" class="Number">0</a> <a id="1259" href="Data.Vec.Base.html#971" class="InductiveConstructor">[]</a>
    <a id="1266" href="present.html#1266" class="InductiveConstructor Operator">_∷_</a>  <a id="1271" class="Symbol">:</a> <a id="1273" class="Symbol">∀</a> <a id="1275" class="Symbol">{</a><a id="1276" href="present.html#1276" class="Bound">d</a> <a id="1278" href="present.html#1278" class="Bound">s</a> <a id="1280" href="present.html#1280" class="Bound">x</a><a id="1281" class="Symbol">}</a> <a id="1283" class="Symbol">→</a> <a id="1285" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="1289" href="present.html#1280" class="Bound">x</a> <a id="1291" class="Symbol">→</a> <a id="1293" href="present.html#1202" class="Datatype">Ix</a> <a id="1296" href="present.html#1276" class="Bound">d</a> <a id="1298" href="present.html#1278" class="Bound">s</a> <a id="1300" class="Symbol">→</a> <a id="1302" href="present.html#1202" class="Datatype">Ix</a> <a id="1305" class="Symbol">(</a><a id="1306" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="1310" href="present.html#1276" class="Bound">d</a><a id="1311" class="Symbol">)</a> <a id="1313" class="Symbol">(</a><a id="1314" href="present.html#1280" class="Bound">x</a> <a id="1316" href="Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="1318" href="present.html#1278" class="Bound">s</a><a id="1319" class="Symbol">)</a>

  <a id="1324" class="Keyword">data</a> <a id="1329" href="present.html#1329" class="Datatype">Ar</a> <a id="1332" class="Symbol">(</a><a id="1333" href="present.html#1333" class="Bound">X</a> <a id="1335" class="Symbol">:</a> <a id="1337" class="PrimitiveType">Set</a><a id="1340" class="Symbol">)</a> <a id="1342" class="Symbol">(</a><a id="1343" href="present.html#1343" class="Bound">d</a> <a id="1345" class="Symbol">:</a> <a id="1347" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="1348" class="Symbol">)</a> <a id="1350" class="Symbol">(</a><a id="1351" href="present.html#1351" class="Bound">s</a> <a id="1353" class="Symbol">:</a> <a id="1355" href="Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="1359" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1361" href="present.html#1343" class="Bound">d</a><a id="1362" class="Symbol">)</a> <a id="1364" class="Symbol">:</a> <a id="1366" class="PrimitiveType">Set</a> <a id="1370" class="Keyword">where</a>
    <a id="1380" href="present.html#1380" class="InductiveConstructor">imap</a> <a id="1385" class="Symbol">:</a> <a id="1387" class="Symbol">(</a><a id="1388" href="present.html#1202" class="Datatype">Ix</a> <a id="1391" href="present.html#1343" class="Bound">d</a> <a id="1393" href="present.html#1351" class="Bound">s</a> <a id="1395" class="Symbol">→</a> <a id="1397" href="present.html#1333" class="Bound">X</a><a id="1398" class="Symbol">)</a> <a id="1400" class="Symbol">→</a> <a id="1402" href="present.html#1329" class="Datatype">Ar</a> <a id="1405" href="present.html#1333" class="Bound">X</a> <a id="1407" href="present.html#1343" class="Bound">d</a> <a id="1409" href="present.html#1351" class="Bound">s</a>
</pre>
</div>
</section>
<section id="examples" class="slide level2">
<h2>Examples</h2>
<!--
<pre class="Agda"><a id="1443" class="Comment">--module _ where</a>
  <a id="1462" class="Keyword">postulate</a>
    <a id="1476" href="present.html#1476" class="Postulate">sum</a> <a id="1480" class="Symbol">:</a> <a id="1482" class="Symbol">∀</a> <a id="1484" class="Symbol">{</a><a id="1485" href="present.html#1485" class="Bound">n</a><a id="1486" class="Symbol">}</a> <a id="1488" class="Symbol">→</a> <a id="1490" href="present.html#1329" class="Datatype">Ar</a> <a id="1493" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1495" class="Number">1</a> <a id="1497" class="Symbol">(</a><a id="1498" href="present.html#1485" class="Bound">n</a> <a id="1500" href="Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="1502" href="Data.Vec.Base.html#971" class="InductiveConstructor">[]</a><a id="1504" class="Symbol">)</a> <a id="1506" class="Symbol">→</a> <a id="1508" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>

  <a id="1513" href="present.html#1513" class="Function">Mat</a> <a id="1517" class="Symbol">:</a> <a id="1519" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1521" class="Symbol">→</a> <a id="1523" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1525" class="Symbol">→</a> <a id="1527" class="PrimitiveType">Set</a>
</pre>-->
Consider a straight-forward matrix transpose:
<pre class="Agda">  <a id="1595" href="present.html#1513" class="Function">Mat</a> <a id="1599" href="present.html#1599" class="Bound">x</a> <a id="1601" href="present.html#1601" class="Bound">y</a> <a id="1603" class="Symbol">=</a> <a id="1605" href="present.html#1329" class="Datatype">Ar</a> <a id="1608" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="1610" class="Number">2</a> <a id="1612" class="Symbol">(</a><a id="1613" href="present.html#1599" class="Bound">x</a> <a id="1615" href="Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="1617" href="present.html#1601" class="Bound">y</a> <a id="1619" href="Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="1621" href="Data.Vec.Base.html#971" class="InductiveConstructor">[]</a><a id="1623" class="Symbol">)</a>

  <a id="1628" href="present.html#1628" class="Function">transpose</a> <a id="1638" class="Symbol">:</a> <a id="1640" class="Symbol">∀</a> <a id="1642" class="Symbol">{</a><a id="1643" href="present.html#1643" class="Bound">a</a> <a id="1645" href="present.html#1645" class="Bound">b</a><a id="1646" class="Symbol">}</a> <a id="1648" class="Symbol">→</a> <a id="1650" href="present.html#1513" class="Function">Mat</a> <a id="1654" href="present.html#1643" class="Bound">a</a> <a id="1656" href="present.html#1645" class="Bound">b</a> <a id="1658" class="Symbol">→</a> <a id="1660" href="present.html#1513" class="Function">Mat</a> <a id="1664" href="present.html#1645" class="Bound">b</a> <a id="1666" href="present.html#1643" class="Bound">a</a>
  <a id="1670" href="present.html#1628" class="Function">transpose</a> <a id="1680" class="Symbol">(</a><a id="1681" href="present.html#1380" class="InductiveConstructor">imap</a> <a id="1686" href="present.html#1686" class="Bound">a</a><a id="1687" class="Symbol">)</a> <a id="1689" class="Symbol">=</a> <a id="1691" href="present.html#1380" class="InductiveConstructor">imap</a> <a id="1696" href="present.html#1711" class="Function">body</a> <a id="1701" class="Keyword">where</a>
    <a id="1711" href="present.html#1711" class="Function">body</a> <a id="1716" class="Symbol">:</a> <a id="1718" class="Symbol">_</a>
    <a id="1724" href="present.html#1711" class="Function">body</a> <a id="1729" class="Symbol">(</a><a id="1730" href="present.html#1730" class="Bound">i</a> <a id="1732" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1734" href="present.html#1734" class="Bound">j</a> <a id="1736" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1738" href="present.html#1247" class="InductiveConstructor">[]</a><a id="1740" class="Symbol">)</a> <a id="1742" class="Symbol">=</a> <a id="1744" href="present.html#1686" class="Bound">a</a> <a id="1746" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="1748" href="present.html#1734" class="Bound">j</a> <a id="1750" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1752" href="present.html#1730" class="Bound">i</a> <a id="1754" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1756" href="present.html#1247" class="InductiveConstructor">[]</a>
</pre>
Matrix multiplication:
<pre class="Agda">  <a id="1793" href="present.html#1793" class="Function">mm</a> <a id="1796" class="Symbol">:</a> <a id="1798" class="Symbol">∀</a> <a id="1800" class="Symbol">{</a><a id="1801" href="present.html#1801" class="Bound">a</a> <a id="1803" href="present.html#1803" class="Bound">b</a> <a id="1805" href="present.html#1805" class="Bound">c</a><a id="1806" class="Symbol">}</a> <a id="1808" class="Symbol">→</a> <a id="1810" href="present.html#1513" class="Function">Mat</a> <a id="1814" href="present.html#1801" class="Bound">a</a> <a id="1816" href="present.html#1803" class="Bound">b</a> <a id="1818" class="Symbol">→</a> <a id="1820" href="present.html#1513" class="Function">Mat</a> <a id="1824" href="present.html#1803" class="Bound">b</a> <a id="1826" href="present.html#1805" class="Bound">c</a> <a id="1828" class="Symbol">→</a> <a id="1830" href="present.html#1513" class="Function">Mat</a> <a id="1834" href="present.html#1801" class="Bound">a</a> <a id="1836" href="present.html#1805" class="Bound">c</a>
  <a id="1840" href="present.html#1793" class="Function">mm</a> <a id="1843" class="Symbol">(</a><a id="1844" href="present.html#1380" class="InductiveConstructor">imap</a> <a id="1849" href="present.html#1849" class="Bound">a</a><a id="1850" class="Symbol">)</a> <a id="1852" class="Symbol">(</a><a id="1853" href="present.html#1380" class="InductiveConstructor">imap</a> <a id="1858" href="present.html#1858" class="Bound">b</a><a id="1859" class="Symbol">)</a> <a id="1861" class="Symbol">=</a> <a id="1863" href="present.html#1380" class="InductiveConstructor">imap</a> <a id="1868" href="present.html#1883" class="Function">body</a> <a id="1873" class="Keyword">where</a>
    <a id="1883" href="present.html#1883" class="Function">body</a> <a id="1888" class="Symbol">:</a> <a id="1890" class="Symbol">_</a>
    <a id="1896" href="present.html#1883" class="Function">body</a> <a id="1901" class="Symbol">(</a><a id="1902" href="present.html#1902" class="Bound">i</a> <a id="1904" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1906" href="present.html#1906" class="Bound">j</a> <a id="1908" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1910" href="present.html#1247" class="InductiveConstructor">[]</a><a id="1912" class="Symbol">)</a> <a id="1914" class="Symbol">=</a> <a id="1916" href="present.html#1476" class="Postulate">sum</a>
      <a id="1926" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="1928" href="present.html#1380" class="InductiveConstructor">imap</a> <a id="1933" class="Symbol">λ</a> <a id="1935" class="Keyword">where</a> <a id="1941" class="Symbol">(</a><a id="1942" href="present.html#1942" class="Bound">k</a> <a id="1944" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1946" href="present.html#1247" class="InductiveConstructor">[]</a><a id="1948" class="Symbol">)</a> <a id="1950" class="Symbol">→</a> <a id="1952" href="present.html#1849" class="Bound">a</a> <a id="1954" class="Symbol">(</a><a id="1955" href="present.html#1902" class="Bound">i</a> <a id="1957" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1959" href="present.html#1942" class="Bound">k</a> <a id="1961" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1963" href="present.html#1247" class="InductiveConstructor">[]</a><a id="1965" class="Symbol">)</a> <a id="1967" href="Agda.Builtin.Nat.html#501" class="Primitive Operator">*</a> <a id="1969" href="present.html#1858" class="Bound">b</a> <a id="1971" class="Symbol">(</a><a id="1972" href="present.html#1942" class="Bound">k</a> <a id="1974" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1976" href="present.html#1906" class="Bound">j</a> <a id="1978" href="present.html#1266" class="InductiveConstructor Operator">∷</a> <a id="1980" href="present.html#1247" class="InductiveConstructor">[]</a><a id="1982" class="Symbol">)</a>
</pre>
</section>
<section id="containers" class="slide level2">
<h2>Containers</h2>
<pre class="Agda">  <a id="2015" class="Keyword">record</a> <a id="2022" href="present.html#2022" class="Record">Con</a> <a id="2026" class="Symbol">:</a> <a id="2028" class="PrimitiveType">Set₁</a> <a id="2033" class="Keyword">where</a>
    <a id="2043" class="Keyword">constructor</a> <a id="2055" href="present.html#2055" class="InductiveConstructor Operator">_◃_</a>
    <a id="2063" class="Keyword">field</a>
      <a id="2075" href="present.html#2075" class="Field">Sh</a> <a id="2078" class="Symbol">:</a> <a id="2080" class="PrimitiveType">Set</a>
      <a id="2090" href="present.html#2090" class="Field">Po</a> <a id="2093" class="Symbol">:</a> <a id="2095" href="present.html#2075" class="Field">Sh</a> <a id="2098" class="Symbol">→</a> <a id="2100" class="PrimitiveType">Set</a>
    <a id="2108" href="present.html#2108" class="Function Operator">⟦_⟧◃</a>  <a id="2114" class="Symbol">:</a> <a id="2116" class="PrimitiveType">Set</a> <a id="2120" class="Symbol">→</a> <a id="2122" class="PrimitiveType">Set</a>
    <a id="2130" href="present.html#2108" class="Function Operator">⟦_⟧◃</a> <a id="2135" href="present.html#2135" class="Bound">X</a> <a id="2137" class="Symbol">=</a> <a id="2139" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="2141" href="present.html#2075" class="Field">Sh</a> <a id="2144" class="Symbol">λ</a> <a id="2146" href="present.html#2146" class="Bound">s</a> <a id="2148" class="Symbol">→</a> <a id="2150" href="present.html#2090" class="Field">Po</a> <a id="2153" href="present.html#2146" class="Bound">s</a> <a id="2155" class="Symbol">→</a> <a id="2157" href="present.html#2135" class="Bound">X</a>
</pre>
<!--
<pre class="Agda">  <a id="2179" class="Keyword">module</a> <a id="hide"></a><a id="2186" href="present.html#2186" class="Module">hide</a> <a id="2191" class="Keyword">where</a>
    <a id="2201" class="Keyword">open</a> <a id="2206" href="present.html#2022" class="Module">Con</a> <a id="2210" class="Keyword">public</a>
    <a id="2221" class="Keyword">postulate</a>
      <a id="2237" href="present.html#2237" class="Postulate Operator">_≅_</a> <a id="2241" class="Symbol">:</a> <a id="2243" class="PrimitiveType">Set</a> <a id="2247" class="Symbol">→</a> <a id="2249" class="PrimitiveType">Set</a> <a id="2253" class="Symbol">→</a> <a id="2255" class="PrimitiveType">Set</a>
</pre>-->
<pre class="Agda">    <a id="2279" href="present.html#2279" class="Function">List</a> <a id="2284" class="Symbol">:</a> <a id="2286" class="PrimitiveType">Set</a> <a id="2290" class="Symbol">→</a> <a id="2292" class="PrimitiveType">Set</a>
    <a id="2300" href="present.html#2279" class="Function">List</a> <a id="2305" href="present.html#2305" class="Bound">X</a> <a id="2307" class="Symbol">=</a> <a id="2309" href="present.html#2108" class="Function Operator">⟦</a> <a id="2311" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="2313" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="2315" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="2319" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="2322" href="present.html#2305" class="Bound">X</a> <a id="2324" class="Comment">-- ≡ Σ ℕ λ n → Fin n → X</a>
</pre>
</section>
<section id="containers-1" class="slide level2">
<h2>Containers</h2>
<blockquote>
<p><code>Ar</code> is nothing but a container.</p>
<p>– Peter Hancock.</p>
</blockquote>
<div class="fragment">
<p>Let us rewrite an array as follows:</p>
<pre class="Agda">  <a id="2484" class="Comment">-- Vec X n ≅ Fin n → X</a>
  <a id="2509" class="Comment">-- Ix d sh ≅ (i : Fin d) → Fin (lookup sh i)</a>

  <a id="2557" href="present.html#2557" class="Function">Ar₁</a> <a id="2561" class="Symbol">:</a> <a id="2563" class="PrimitiveType">Set</a> <a id="2567" class="Symbol">→</a> <a id="2569" class="PrimitiveType">Set</a>
  <a id="2575" href="present.html#2557" class="Function">Ar₁</a> <a id="2579" href="present.html#2579" class="Bound">X</a> <a id="2581" class="Symbol">=</a> <a id="2583" class="Symbol">(</a><a id="2584" href="present.html#2584" class="Bound">d</a> <a id="2586" class="Symbol">:</a> <a id="2588" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="2589" class="Symbol">)</a> <a id="2591" class="Symbol">→</a> <a id="2593" class="Symbol">(</a><a id="2594" href="present.html#2594" class="Bound">sh</a> <a id="2597" class="Symbol">:</a> <a id="2599" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="2603" href="present.html#2584" class="Bound">d</a> <a id="2605" class="Symbol">→</a> <a id="2607" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="2608" class="Symbol">)</a>
                  <a id="2628" class="Symbol">→</a> <a id="2630" class="Symbol">(((</a><a id="2633" href="present.html#2633" class="Bound">i</a> <a id="2635" class="Symbol">:</a> <a id="2637" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="2641" href="present.html#2584" class="Bound">d</a><a id="2642" class="Symbol">)</a> <a id="2644" class="Symbol">→</a> <a id="2646" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="2650" class="Symbol">(</a><a id="2651" href="present.html#2594" class="Bound">sh</a> <a id="2654" href="present.html#2633" class="Bound">i</a><a id="2655" class="Symbol">))</a> <a id="2658" class="Symbol">→</a> <a id="2660" href="present.html#2579" class="Bound">X</a><a id="2661" class="Symbol">)</a>
</pre>
</div>
</section>
<section id="containers-2" class="slide level2">
<h2>Containers</h2>
After uncurrying first two arguments: <!--
<pre class="Agda">  <a id="2735" class="Keyword">open</a> <a id="2740" href="present.html#2022" class="Module">Con</a> <a id="2744" class="Keyword">public</a>
  <a id="2753" class="Keyword">infixl</a> <a id="2760" class="Number">2</a> <a id="2762" href="present.html#2055" class="InductiveConstructor Operator">_◃_</a>
</pre>-->
<pre class="Agda">  <a id="2784" href="present.html#2784" class="Function">Ar₂</a> <a id="2788" class="Symbol">:</a> <a id="2790" class="PrimitiveType">Set</a> <a id="2794" class="Symbol">→</a> <a id="2796" class="PrimitiveType">Set</a>
  <a id="2802" href="present.html#2784" class="Function">Ar₂</a> <a id="2806" href="present.html#2806" class="Bound">X</a> <a id="2808" class="Symbol">=</a> <a id="2810" href="present.html#2108" class="Function Operator">⟦</a> <a id="2812" class="Symbol">(</a><a id="2813" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="2815" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="2817" class="Symbol">λ</a> <a id="2819" href="present.html#2819" class="Bound">d</a> <a id="2821" class="Symbol">→</a> <a id="2823" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="2827" href="present.html#2819" class="Bound">d</a> <a id="2829" class="Symbol">→</a> <a id="2831" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="2832" class="Symbol">)</a>
            <a id="2846" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="2848" class="Symbol">(λ</a> <a id="2851" class="Keyword">where</a> <a id="2857" class="Symbol">(</a><a id="2858" href="present.html#2858" class="Bound">d</a> <a id="2860" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2862" href="present.html#2862" class="Bound">sh</a><a id="2864" class="Symbol">)</a> <a id="2866" class="Symbol">→</a> <a id="2868" class="Symbol">(</a><a id="2869" href="present.html#2869" class="Bound">i</a> <a id="2871" class="Symbol">:</a> <a id="2873" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="2877" href="present.html#2858" class="Bound">d</a><a id="2878" class="Symbol">)</a> <a id="2880" class="Symbol">→</a> <a id="2882" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="2886" class="Symbol">(</a><a id="2887" href="present.html#2862" class="Bound">sh</a> <a id="2890" href="present.html#2869" class="Bound">i</a><a id="2891" class="Symbol">))</a> <a id="2894" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="2897" href="present.html#2806" class="Bound">X</a>
</pre>
After noticing that the first <code>Σ</code> is a container:
<pre class="Agda">  <a id="2964" href="present.html#2964" class="Function">Ar₃</a> <a id="2968" class="Symbol">:</a> <a id="2970" class="PrimitiveType">Set</a> <a id="2974" class="Symbol">→</a> <a id="2976" class="PrimitiveType">Set</a>
  <a id="2982" href="present.html#2964" class="Function">Ar₃</a> <a id="2986" href="present.html#2986" class="Bound">X</a> <a id="2988" class="Symbol">=</a> <a id="2990" href="present.html#2108" class="Function Operator">⟦</a> <a id="2992" href="present.html#2108" class="Function Operator">⟦</a> <a id="2994" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="2996" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="2998" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="3002" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="3005" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>
            <a id="3019" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3021" class="Symbol">(λ</a> <a id="3024" class="Keyword">where</a> <a id="3030" class="Symbol">(</a><a id="3031" href="present.html#3031" class="Bound">d</a> <a id="3033" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3035" href="present.html#3035" class="Bound">sh</a><a id="3037" class="Symbol">)</a> <a id="3039" class="Symbol">→</a> <a id="3041" class="Symbol">(</a><a id="3042" href="present.html#3042" class="Bound">i</a> <a id="3044" class="Symbol">:</a> <a id="3046" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="3050" href="present.html#3031" class="Bound">d</a><a id="3051" class="Symbol">)</a> <a id="3053" class="Symbol">→</a> <a id="3055" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="3059" class="Symbol">(</a><a id="3060" href="present.html#3035" class="Bound">sh</a> <a id="3063" href="present.html#3042" class="Bound">i</a><a id="3064" class="Symbol">))</a> <a id="3067" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="3070" href="present.html#2986" class="Bound">X</a>
</pre>
</section>
<section id="containers-3" class="slide level2">
<h2>Containers</h2>
<p>Finally, let us generalise this into a container operation:</p>
<pre class="Agda">  <a id="3163" href="present.html#3163" class="Function">Π</a> <a id="3165" class="Symbol">:</a> <a id="3167" class="Symbol">(</a><a id="3168" href="present.html#3168" class="Bound">A</a> <a id="3170" class="Symbol">:</a> <a id="3172" class="PrimitiveType">Set</a><a id="3175" class="Symbol">)</a> <a id="3177" class="Symbol">→</a> <a id="3179" class="Symbol">(</a><a id="3180" href="present.html#3168" class="Bound">A</a> <a id="3182" class="Symbol">→</a> <a id="3184" class="PrimitiveType">Set</a><a id="3187" class="Symbol">)</a> <a id="3189" class="Symbol">→</a> <a id="3191" class="PrimitiveType">Set</a>
  <a id="3197" href="present.html#3163" class="Function">Π</a> <a id="3199" href="present.html#3199" class="Bound">A</a> <a id="3201" href="present.html#3201" class="Bound">B</a> <a id="3203" class="Symbol">=</a> <a id="3205" class="Symbol">(</a><a id="3206" href="present.html#3206" class="Bound">i</a> <a id="3208" class="Symbol">:</a> <a id="3210" href="present.html#3199" class="Bound">A</a><a id="3211" class="Symbol">)</a> <a id="3213" class="Symbol">→</a> <a id="3215" href="present.html#3201" class="Bound">B</a> <a id="3217" href="present.html#3206" class="Bound">i</a>

  <a id="3222" href="present.html#3222" class="Function Operator">_⋄_</a> <a id="3226" class="Symbol">:</a> <a id="3228" href="present.html#2022" class="Record">Con</a> <a id="3232" class="Symbol">→</a> <a id="3234" href="present.html#2022" class="Record">Con</a> <a id="3238" class="Symbol">→</a> <a id="3240" href="present.html#2022" class="Record">Con</a>
  <a id="3246" class="Symbol">(</a><a id="3247" href="present.html#3247" class="Bound">A</a> <a id="3249" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3251" href="present.html#3251" class="Bound">B</a><a id="3252" class="Symbol">)</a> <a id="3254" href="present.html#3222" class="Function Operator">⋄</a> <a id="3256" class="Symbol">(</a><a id="3257" href="present.html#3257" class="Bound">C</a> <a id="3259" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3261" href="present.html#3261" class="Bound">D</a><a id="3262" class="Symbol">)</a> <a id="3264" class="Symbol">=</a> <a id="3266" href="present.html#2108" class="Function Operator">⟦</a> <a id="3268" href="present.html#3247" class="Bound">A</a> <a id="3270" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3272" href="present.html#3251" class="Bound">B</a> <a id="3274" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="3277" href="present.html#3257" class="Bound">C</a>
                      <a id="3301" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3303" class="Symbol">λ</a> <a id="3305" class="Symbol">{</a> <a id="3307" class="Symbol">(</a><a id="3308" href="present.html#3308" class="Bound">a</a> <a id="3310" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3312" href="present.html#3312" class="Bound">γ</a><a id="3313" class="Symbol">)</a> <a id="3315" class="Symbol">→</a> <a id="3317" href="present.html#3163" class="Function">Π</a> <a id="3319" class="Symbol">(</a><a id="3320" href="present.html#3251" class="Bound">B</a> <a id="3322" href="present.html#3308" class="Bound">a</a><a id="3323" class="Symbol">)</a> <a id="3325" class="Symbol">(</a><a id="3326" href="present.html#3261" class="Bound">D</a> <a id="3328" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="3330" href="present.html#3312" class="Bound">γ</a><a id="3331" class="Symbol">)</a> <a id="3333" class="Symbol">}</a>
</pre>
<p>In this case, we can rewrite an array type as:</p>
<pre class="Agda">  <a id="3397" href="present.html#3397" class="Function">Array</a> <a id="3403" class="Symbol">:</a> <a id="3405" class="PrimitiveType">Set</a> <a id="3409" class="Symbol">→</a> <a id="3411" class="PrimitiveType">Set</a>
  <a id="3417" href="present.html#3397" class="Function">Array</a> <a id="3423" href="present.html#3423" class="Bound">X</a> <a id="3425" class="Symbol">=</a> <a id="3427" href="present.html#2108" class="Function Operator">⟦</a> <a id="3429" class="Symbol">(</a><a id="3430" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="3432" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3434" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="3437" class="Symbol">)</a> <a id="3439" href="present.html#3222" class="Function Operator">⋄</a> <a id="3441" class="Symbol">(</a><a id="3442" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="3444" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3446" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="3449" class="Symbol">)</a> <a id="3451" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="3454" href="present.html#3423" class="Bound">X</a>
</pre>
</section>
<section id="the-operation" class="slide level2">
<h2>The ⋄ operation</h2>
<p>An intuitive explanation of the <code>_⋄_</code> can be seen through the tensor product <code>_⊗_</code> on containers that is defined as:</p>
<pre class="Agda">  <a id="3610" href="present.html#3610" class="Function Operator">_⊗_</a> <a id="3614" class="Symbol">:</a> <a id="3616" href="present.html#2022" class="Record">Con</a> <a id="3620" class="Symbol">→</a> <a id="3622" href="present.html#2022" class="Record">Con</a> <a id="3626" class="Symbol">→</a> <a id="3628" href="present.html#2022" class="Record">Con</a>
  <a id="3634" class="Symbol">(</a><a id="3635" href="present.html#3635" class="Bound">A</a> <a id="3637" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3639" href="present.html#3639" class="Bound">B</a><a id="3640" class="Symbol">)</a> <a id="3642" href="present.html#3610" class="Function Operator">⊗</a> <a id="3644" class="Symbol">(</a><a id="3645" href="present.html#3645" class="Bound">C</a> <a id="3647" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3649" href="present.html#3649" class="Bound">D</a><a id="3650" class="Symbol">)</a> <a id="3652" class="Symbol">=</a> <a id="3654" class="Symbol">(</a><a id="3655" href="present.html#3635" class="Bound">A</a> <a id="3657" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="3659" href="present.html#3645" class="Bound">C</a><a id="3660" class="Symbol">)</a> <a id="3662" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="3664" class="Symbol">λ</a> <a id="3666" class="Keyword">where</a> <a id="3672" class="Symbol">(</a><a id="3673" href="present.html#3673" class="Bound">a</a> <a id="3675" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3677" href="present.html#3677" class="Bound">c</a><a id="3678" class="Symbol">)</a> <a id="3680" class="Symbol">→</a> <a id="3682" href="present.html#3639" class="Bound">B</a> <a id="3684" href="present.html#3673" class="Bound">a</a> <a id="3686" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="3688" href="present.html#3649" class="Bound">D</a> <a id="3690" href="present.html#3677" class="Bound">c</a>
</pre>
<p>Now assume that we want to compute an <span class="math inline"><em>n</em></span>-fold tensor product of a container <code>C ◃ D</code>. That is: <code>(C ◃ D) ⊗ (C ◃ D) ⊗ ⋯</code>. In this case we can set “the boundaries” of the product using <code>A ◃ B</code>.</p>
<p><br /><span class="math display">(<em>A</em> ◃ <em>B</em>) ⋄ (<em>C</em> ◃ <em>D</em>) = ⨂<sub>(<em>A</em> ◃ <em>B</em>)</sub>(<em>C</em> ◃ <em>D</em>)</span><br /></p>
</section>
<section id="the-operation-1" class="slide level2">
<h2>The ⋄ operation</h2>
A nice analogy that we observe: tensor product “replaces” <code>+</code> with <code>×</code> in: <!--
<pre class="Agda">  <a id="4063" href="present.html#4063" class="Function Operator">_×&#39;_</a> <a id="4068" href="present.html#4068" class="Function Operator">_⊗&#39;_</a> <a id="4073" class="Symbol">:</a> <a id="4075" href="present.html#2022" class="Record">Con</a> <a id="4079" class="Symbol">→</a> <a id="4081" href="present.html#2022" class="Record">Con</a> <a id="4085" class="Symbol">→</a> <a id="4087" href="present.html#2022" class="Record">Con</a>
  <a id="4093" href="present.html#4093" class="Function Operator">_∘&#39;_</a> <a id="4098" href="present.html#4098" class="Function Operator">_⋄&#39;_</a> <a id="4103" class="Symbol">:</a> <a id="4105" href="present.html#2022" class="Record">Con</a> <a id="4109" class="Symbol">→</a> <a id="4111" href="present.html#2022" class="Record">Con</a> <a id="4115" class="Symbol">→</a> <a id="4117" href="present.html#2022" class="Record">Con</a>

</pre>-->
<pre class="Agda">  <a id="4140" class="Symbol">(</a><a id="4141" href="present.html#4141" class="Bound">A</a> <a id="4143" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4145" href="present.html#4145" class="Bound">B</a><a id="4146" class="Symbol">)</a> <a id="4148" href="present.html#4063" class="Function Operator">×&#39;</a> <a id="4151" class="Symbol">(</a><a id="4152" href="present.html#4152" class="Bound">C</a> <a id="4154" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4156" href="present.html#4156" class="Bound">D</a><a id="4157" class="Symbol">)</a> <a id="4159" class="Symbol">=</a> <a id="4161" class="Symbol">(</a><a id="4162" href="present.html#4141" class="Bound">A</a> <a id="4164" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4166" href="present.html#4152" class="Bound">C</a><a id="4167" class="Symbol">)</a> <a id="4169" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4171" class="Symbol">λ</a> <a id="4173" class="Keyword">where</a> <a id="4179" class="Symbol">(</a><a id="4180" href="present.html#4180" class="Bound">a</a> <a id="4182" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4184" href="present.html#4184" class="Bound">c</a><a id="4185" class="Symbol">)</a> <a id="4187" class="Symbol">→</a> <a id="4189" href="present.html#4145" class="Bound">B</a> <a id="4191" href="present.html#4180" class="Bound">a</a> <a id="4193" href="Data.Sum.Base.html#617" class="Datatype Operator">⊎</a> <a id="4195" href="present.html#4156" class="Bound">D</a> <a id="4197" href="present.html#4184" class="Bound">c</a>
  <a id="4201" class="Symbol">(</a><a id="4202" href="present.html#4202" class="Bound">A</a> <a id="4204" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4206" href="present.html#4206" class="Bound">B</a><a id="4207" class="Symbol">)</a> <a id="4209" href="present.html#4068" class="Function Operator">⊗&#39;</a> <a id="4212" class="Symbol">(</a><a id="4213" href="present.html#4213" class="Bound">C</a> <a id="4215" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4217" href="present.html#4217" class="Bound">D</a><a id="4218" class="Symbol">)</a> <a id="4220" class="Symbol">=</a> <a id="4222" class="Symbol">(</a><a id="4223" href="present.html#4202" class="Bound">A</a> <a id="4225" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4227" href="present.html#4213" class="Bound">C</a><a id="4228" class="Symbol">)</a> <a id="4230" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4232" class="Symbol">λ</a> <a id="4234" class="Keyword">where</a> <a id="4240" class="Symbol">(</a><a id="4241" href="present.html#4241" class="Bound">a</a> <a id="4243" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4245" href="present.html#4245" class="Bound">c</a><a id="4246" class="Symbol">)</a> <a id="4248" class="Symbol">→</a> <a id="4250" href="present.html#4206" class="Bound">B</a> <a id="4252" href="present.html#4241" class="Bound">a</a> <a id="4254" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4256" href="present.html#4217" class="Bound">D</a> <a id="4258" href="present.html#4245" class="Bound">c</a>
</pre>
<p>In a similar way <code>⋄</code> replaces <code>Σ</code> with <code>Π</code> in:</p>
<pre class="Agda">  <a id="4322" class="Symbol">(</a><a id="4323" href="present.html#4323" class="Bound">A</a> <a id="4325" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4327" href="present.html#4327" class="Bound">B</a><a id="4328" class="Symbol">)</a> <a id="4330" href="present.html#4093" class="Function Operator">∘&#39;</a> <a id="4333" class="Symbol">(</a><a id="4334" href="present.html#4334" class="Bound">C</a> <a id="4336" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4338" href="present.html#4338" class="Bound">D</a><a id="4339" class="Symbol">)</a> <a id="4341" class="Symbol">=</a> <a id="4343" href="present.html#2108" class="Function Operator">⟦</a> <a id="4345" href="present.html#4323" class="Bound">A</a> <a id="4347" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4349" href="present.html#4327" class="Bound">B</a> <a id="4351" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="4354" href="present.html#4334" class="Bound">C</a> <a id="4356" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4358" class="Symbol">λ</a> <a id="4360" class="Keyword">where</a> <a id="4366" class="Symbol">(</a><a id="4367" href="present.html#4367" class="Bound">a</a> <a id="4369" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4371" href="present.html#4371" class="Bound">γ</a><a id="4372" class="Symbol">)</a> <a id="4374" class="Symbol">→</a> <a id="4376" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="4378" class="Symbol">(</a><a id="4379" href="present.html#4327" class="Bound">B</a> <a id="4381" href="present.html#4367" class="Bound">a</a><a id="4382" class="Symbol">)</a> <a id="4384" class="Symbol">(</a><a id="4385" href="present.html#4338" class="Bound">D</a> <a id="4387" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="4389" href="present.html#4371" class="Bound">γ</a><a id="4390" class="Symbol">)</a>
  <a id="4394" class="Symbol">(</a><a id="4395" href="present.html#4395" class="Bound">A</a> <a id="4397" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4399" href="present.html#4399" class="Bound">B</a><a id="4400" class="Symbol">)</a> <a id="4402" href="present.html#4098" class="Function Operator">⋄&#39;</a> <a id="4405" class="Symbol">(</a><a id="4406" href="present.html#4406" class="Bound">C</a> <a id="4408" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4410" href="present.html#4410" class="Bound">D</a><a id="4411" class="Symbol">)</a> <a id="4413" class="Symbol">=</a> <a id="4415" href="present.html#2108" class="Function Operator">⟦</a> <a id="4417" href="present.html#4395" class="Bound">A</a> <a id="4419" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4421" href="present.html#4399" class="Bound">B</a> <a id="4423" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="4426" href="present.html#4406" class="Bound">C</a> <a id="4428" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4430" class="Symbol">λ</a> <a id="4432" class="Keyword">where</a> <a id="4438" class="Symbol">(</a><a id="4439" href="present.html#4439" class="Bound">a</a> <a id="4441" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4443" href="present.html#4443" class="Bound">γ</a><a id="4444" class="Symbol">)</a> <a id="4446" class="Symbol">→</a> <a id="4448" href="present.html#3163" class="Function">Π</a> <a id="4450" class="Symbol">(</a><a id="4451" href="present.html#4399" class="Bound">B</a> <a id="4453" href="present.html#4439" class="Bound">a</a><a id="4454" class="Symbol">)</a> <a id="4456" class="Symbol">(</a><a id="4457" href="present.html#4410" class="Bound">D</a> <a id="4459" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="4461" href="present.html#4443" class="Bound">γ</a><a id="4462" class="Symbol">)</a>
</pre>
</section></section>
<section>
<section id="array-hierarchy" class="title-slide slide level1">
<h1>Array Hierarchy</h1>
<p>As <code>_⋄_ : Con → Con → Con</code>, it can be iterated. As <code>_⋄_</code> is not associative, iteration on the left and on the right gives different results.</p>
<pre class="Agda">  <a id="4640" href="present.html#4640" class="Function">1ₐ</a> <a id="4643" class="Symbol">:</a> <a id="4645" href="present.html#2022" class="Record">Con</a>
  <a id="4651" href="present.html#4640" class="Function">1ₐ</a> <a id="4654" class="Symbol">=</a> <a id="4656" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a> <a id="4658" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4660" class="Symbol">λ</a> <a id="4662" href="present.html#4662" class="Bound">_</a> <a id="4664" class="Symbol">→</a> <a id="4666" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>

  <a id="4671" href="present.html#4671" class="Function">AL</a> <a id="4674" class="Symbol">:</a> <a id="4676" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4678" class="Symbol">→</a> <a id="4680" href="present.html#2022" class="Record">Con</a>
  <a id="4686" href="present.html#4671" class="Function">AL</a> <a id="4689" class="Number">0</a> <a id="4691" class="Symbol">=</a> <a id="4693" href="present.html#4640" class="Function">1ₐ</a>
  <a id="4698" href="present.html#4671" class="Function">AL</a> <a id="4701" class="Symbol">(</a><a id="4702" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="4706" href="present.html#4706" class="Bound">x</a><a id="4707" class="Symbol">)</a> <a id="4709" class="Symbol">=</a> <a id="4711" class="Symbol">(</a><a id="4712" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4714" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4716" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="4719" class="Symbol">)</a> <a id="4721" href="present.html#3222" class="Function Operator">⋄</a> <a id="4723" class="Symbol">(</a><a id="4724" href="present.html#4671" class="Function">AL</a> <a id="4727" href="present.html#4706" class="Bound">x</a><a id="4728" class="Symbol">)</a>

  <a id="4733" href="present.html#4733" class="Function">AR</a> <a id="4736" class="Symbol">:</a> <a id="4738" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4740" class="Symbol">→</a> <a id="4742" href="present.html#2022" class="Record">Con</a>
  <a id="4748" href="present.html#4733" class="Function">AR</a> <a id="4751" class="Number">0</a> <a id="4753" class="Symbol">=</a> <a id="4755" href="present.html#4640" class="Function">1ₐ</a>
  <a id="4760" href="present.html#4733" class="Function">AR</a> <a id="4763" class="Symbol">(</a><a id="4764" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="4768" href="present.html#4768" class="Bound">x</a><a id="4769" class="Symbol">)</a> <a id="4771" class="Symbol">=</a> <a id="4773" class="Symbol">(</a><a id="4774" href="present.html#4733" class="Function">AR</a> <a id="4777" href="present.html#4768" class="Bound">x</a><a id="4778" class="Symbol">)</a> <a id="4780" href="present.html#3222" class="Function Operator">⋄</a> <a id="4782" class="Symbol">(</a><a id="4783" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4785" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4787" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="4790" class="Symbol">)</a>
</pre>
</section>
<section id="iterating-on-the-left-right-assoc" class="slide level2">
<h2>Iterating ⋄ on the left (right assoc)</h2>
<p>Iteration on the left makes the “counting container” more complex.</p>
<pre class="Agda">  <a id="4917" href="present.html#4917" class="Function">AL₃</a> <a id="4921" class="Symbol">:</a> <a id="4923" class="PrimitiveType">Set</a> <a id="4927" class="Symbol">→</a> <a id="4929" class="PrimitiveType">Set</a>
  <a id="4935" href="present.html#4917" class="Function">AL₃</a> <a id="4939" href="present.html#4939" class="Bound">X</a> <a id="4941" class="Symbol">=</a> <a id="4943" href="present.html#2108" class="Function Operator">⟦</a> <a id="4945" class="Symbol">(</a><a id="4946" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4948" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4950" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="4953" class="Symbol">)</a> <a id="4955" href="present.html#3222" class="Function Operator">⋄</a> <a id="4957" class="Symbol">((</a><a id="4959" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4961" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4963" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="4966" class="Symbol">)</a> <a id="4968" href="present.html#3222" class="Function Operator">⋄</a> <a id="4970" class="Symbol">(</a><a id="4971" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4973" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="4975" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="4978" class="Symbol">))</a> <a id="4981" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="4984" href="present.html#4939" class="Bound">X</a>

  <a id="4989" href="present.html#4989" class="Function">sanityₗ</a> <a id="4997" class="Symbol">:</a> <a id="4999" class="Symbol">∀</a> <a id="5001" href="present.html#5001" class="Bound">X</a> <a id="5003" class="Symbol">→</a> <a id="5005" href="present.html#4917" class="Function">AL₃</a> <a id="5009" href="present.html#5001" class="Bound">X</a>
          <a id="5021" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="5023" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="5025" class="Symbol">(</a><a id="5026" href="present.html#2108" class="Function Operator">⟦</a> <a id="5028" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5030" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="5032" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5036" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="5039" class="Symbol">(</a><a id="5040" href="present.html#2108" class="Function Operator">⟦</a> <a id="5042" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5044" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="5046" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5050" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="5053" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="5054" class="Symbol">))</a> <a id="5057" class="Comment">-- Vec of Vec of ℕ</a>
              <a id="5090" class="Symbol">λ</a> <a id="5092" class="Symbol">{</a> <a id="5094" class="Symbol">(</a><a id="5095" href="present.html#5095" class="Bound">ss</a> <a id="5098" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5100" href="present.html#5100" class="Bound">ff</a><a id="5102" class="Symbol">)</a>
                  <a id="5122" class="Symbol">→</a> <a id="5124" class="Symbol">((</a><a id="5126" href="present.html#5126" class="Bound">ii</a> <a id="5129" class="Symbol">:</a> <a id="5131" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5135" href="present.html#5095" class="Bound">ss</a><a id="5137" class="Symbol">)</a>
                      <a id="5161" class="Symbol">→</a> <a id="5163" class="Keyword">let</a> <a id="5167" href="present.html#5167" class="Bound">s</a> <a id="5169" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5171" href="present.html#5171" class="Bound">f</a> <a id="5173" class="Symbol">=</a> <a id="5175" href="present.html#5100" class="Bound">ff</a> <a id="5178" href="present.html#5126" class="Bound">ii</a> <a id="5181" class="Keyword">in</a>
                         <a id="5209" class="Symbol">(</a><a id="5210" href="present.html#5210" class="Bound">i</a> <a id="5212" class="Symbol">:</a> <a id="5214" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5218" href="present.html#5167" class="Bound">s</a><a id="5219" class="Symbol">)</a> <a id="5221" class="Symbol">→</a> <a id="5223" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5227" class="Symbol">(</a><a id="5228" href="present.html#5171" class="Bound">f</a> <a id="5230" href="present.html#5210" class="Bound">i</a><a id="5231" class="Symbol">))</a> <a id="5234" class="Symbol">→</a> <a id="5236" href="present.html#5001" class="Bound">X</a><a id="5237" class="Symbol">}</a>
  <a id="5241" href="present.html#4989" class="Function">sanityₗ</a> <a id="5249" href="present.html#5249" class="Bound">X</a> <a id="5251" class="Symbol">=</a> <a id="5253" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>

  <a id="5261" class="Comment">-- The shape of level-3 array becomes inhomogeneous, e.g:</a>
  <a id="5321" class="Comment">--     2</a>
  <a id="5332" class="Comment">--     3 4 5 6</a>
  <a id="5349" class="Comment">--     1 2</a>
</pre>
</section>
<section id="iterating-on-the-right-left-assoc" class="slide level2">
<h2>Iterating ⋄ on the right (left assoc)</h2>
<pre class="Agda">  <a id="5419" href="present.html#5419" class="Function">AR₃</a> <a id="5423" class="Symbol">:</a> <a id="5425" class="PrimitiveType">Set</a> <a id="5429" class="Symbol">→</a> <a id="5431" class="PrimitiveType">Set</a>
  <a id="5437" href="present.html#5419" class="Function">AR₃</a> <a id="5441" href="present.html#5441" class="Bound">X</a> <a id="5443" class="Symbol">=</a> <a id="5445" href="present.html#2108" class="Function Operator">⟦</a> <a id="5447" class="Symbol">((</a><a id="5449" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5451" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="5453" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="5456" class="Symbol">)</a> <a id="5458" href="present.html#3222" class="Function Operator">⋄</a> <a id="5460" class="Symbol">(</a><a id="5461" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5463" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="5465" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="5468" class="Symbol">))</a> <a id="5471" href="present.html#3222" class="Function Operator">⋄</a> <a id="5473" class="Symbol">(</a><a id="5474" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5476" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="5478" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="5481" class="Symbol">)</a> <a id="5483" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="5486" href="present.html#5441" class="Bound">X</a>

  <a id="5491" href="present.html#5491" class="Function">sanityᵣ</a> <a id="5499" class="Symbol">:</a> <a id="5501" class="Symbol">∀</a> <a id="5503" href="present.html#5503" class="Bound">X</a> <a id="5505" class="Symbol">→</a> <a id="5507" href="present.html#5419" class="Function">AR₃</a> <a id="5511" href="present.html#5503" class="Bound">X</a>
          <a id="5523" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="5525" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="5527" class="Symbol">(</a><a id="5528" href="present.html#2108" class="Function Operator">⟦</a> <a id="5530" class="Symbol">(</a><a id="5531" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5533" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="5535" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="5538" class="Symbol">)</a> <a id="5540" href="present.html#3222" class="Function Operator">⋄</a> <a id="5542" class="Symbol">(</a><a id="5543" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5545" href="present.html#2055" class="InductiveConstructor Operator">◃</a> <a id="5547" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a><a id="5550" class="Symbol">)</a> <a id="5552" href="present.html#2108" class="Function Operator">⟧◃</a> <a id="5555" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="5556" class="Symbol">)</a>
              <a id="5572" class="Symbol">λ</a> <a id="5574" class="Symbol">{</a> <a id="5576" class="Symbol">((</a><a id="5578" href="present.html#5578" class="Bound">d</a> <a id="5580" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5582" href="present.html#5582" class="Bound">s</a><a id="5583" class="Symbol">)</a> <a id="5585" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5587" href="present.html#5587" class="Bound">ss</a><a id="5589" class="Symbol">)</a> <a id="5591" class="Comment">-- ss is array of shape s of ℕ</a>
                  <a id="5640" class="Symbol">→</a> <a id="5642" href="present.html#3163" class="Function">Π</a> <a id="5644" class="Symbol">(</a><a id="5645" href="present.html#3163" class="Function">Π</a> <a id="5647" class="Symbol">(</a><a id="5648" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5652" href="present.html#5578" class="Bound">d</a><a id="5653" class="Symbol">)</a> <a id="5655" class="Symbol">(</a><a id="5656" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5660" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="5662" href="present.html#5582" class="Bound">s</a><a id="5663" class="Symbol">))</a> <a id="5666" class="Symbol">(</a><a id="5667" href="Data.Fin.Base.html#1061" class="Datatype">Fin</a> <a id="5671" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="5673" href="present.html#5587" class="Bound">ss</a><a id="5675" class="Symbol">)</a> <a id="5677" class="Symbol">→</a> <a id="5679" href="present.html#5503" class="Bound">X</a><a id="5680" class="Symbol">}</a>
  <a id="5684" href="present.html#5491" class="Function">sanityᵣ</a> <a id="5692" href="present.html#5692" class="Bound">X</a> <a id="5694" class="Symbol">=</a> <a id="5696" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>The shape of level-3 array is a level-2 array of <code>ℕ</code></p>
</section>
<section id="ar-hierarchy" class="slide level2">
<h2><code>AR</code> hierarchy</h2>
<p>By adopting <code>AR</code>, all the shapes (&gt; level-0) are arrays themselves:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Level</th>
<th style="text-align: left;">Shape</th>
<th style="text-align: left;">Array</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">level-0</td>
<td style="text-align: left;"><code>⊤</code></td>
<td style="text-align: left;">“scalars” (0-dimensional)</td>
</tr>
<tr class="even">
<td style="text-align: left;">level-1</td>
<td style="text-align: left;">level-0 of ℕ</td>
<td style="text-align: left;">vectors (1-dimensional)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">level-2</td>
<td style="text-align: left;">level-1 of ℕ</td>
<td style="text-align: left;">multi-dimensional</td>
</tr>
<tr class="even">
<td style="text-align: left;">level-3</td>
<td style="text-align: left;">level-2 of ℕ</td>
<td style="text-align: left;">multi-multi-dimensional</td>
</tr>
<tr class="odd">
<td style="text-align: left;">…</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<div class="fragment">
<p>Note: all of the higher-level arrays (&gt; 1) can be mapped into vectors (level 1).</p>
</div>
</section></section>
<section id="practical-use" class="title-slide slide level1">
<h1>Practical use</h1>
<p>Average pooling example using ranked operator (demo).</p>
</section>

<section id="encoding" class="title-slide slide level1">
<h1>Encoding</h1>
<!--
<pre class="Agda"><a id="6323" class="Keyword">module</a> <a id="encoding"></a><a id="6330" href="present.html#6330" class="Module">encoding</a> <a id="6339" class="Keyword">where</a>
</pre>-->
<pre class="Agda">  <a id="encoding.ShType"></a><a id="6363" href="present.html#6363" class="Function">ShType</a> <a id="6370" class="Symbol">:</a> <a id="6372" class="Symbol">(</a><a id="6373" href="present.html#6373" class="Bound">l</a> <a id="6375" class="Symbol">:</a> <a id="6377" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="6378" class="Symbol">)</a> <a id="6380" class="Symbol">→</a> <a id="6382" class="PrimitiveType">Set</a>
  <a id="encoding.IxType"></a><a id="6388" href="present.html#6388" class="Function">IxType</a> <a id="6395" class="Symbol">:</a> <a id="6397" class="Symbol">(</a><a id="6398" href="present.html#6398" class="Bound">l</a> <a id="6400" class="Symbol">:</a> <a id="6402" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="6403" class="Symbol">)</a> <a id="6405" class="Symbol">→</a> <a id="6407" href="present.html#6363" class="Function">ShType</a> <a id="6414" href="present.html#6398" class="Bound">l</a> <a id="6416" class="Symbol">→</a> <a id="6418" class="PrimitiveType">Set</a>
  <a id="encoding.ReprAr"></a><a id="6424" href="present.html#6424" class="Function">ReprAr</a> <a id="6431" class="Symbol">:</a> <a id="6433" class="Symbol">∀</a> <a id="6435" href="present.html#6435" class="Bound">l</a> <a id="6437" class="Symbol">(</a><a id="6438" href="present.html#6438" class="Bound">X</a> <a id="6440" class="Symbol">:</a> <a id="6442" class="PrimitiveType">Set</a><a id="6445" class="Symbol">)</a> <a id="6447" class="Symbol">→</a> <a id="6449" class="PrimitiveType">Set</a>

  <a id="6456" class="Keyword">record</a> <a id="encoding.IxLvl"></a><a id="6463" href="present.html#6463" class="Record">IxLvl</a> <a id="6469" class="Symbol">(</a><a id="6470" href="present.html#6470" class="Bound">l</a> <a id="6472" class="Symbol">:</a> <a id="6474" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="6475" class="Symbol">)</a> <a id="6477" class="Symbol">(</a><a id="6478" href="present.html#6478" class="Bound">s</a> <a id="6480" class="Symbol">:</a> <a id="6482" href="present.html#6363" class="Function">ShType</a> <a id="6489" href="present.html#6470" class="Bound">l</a><a id="6490" class="Symbol">)</a> <a id="6492" class="Symbol">:</a> <a id="6494" class="PrimitiveType">Set</a> <a id="6498" class="Keyword">where</a>
    <a id="6508" class="Keyword">constructor</a> <a id="encoding.IxLvl.ix"></a><a id="6520" href="present.html#6520" class="InductiveConstructor">ix</a>
    <a id="6527" class="Keyword">field</a> <a id="encoding.IxLvl.flat-ix"></a><a id="6533" href="present.html#6533" class="Field">flat-ix</a> <a id="6541" class="Symbol">:</a> <a id="6543" href="present.html#6388" class="Function">IxType</a> <a id="6550" href="present.html#6470" class="Bound">l</a> <a id="6552" href="present.html#6478" class="Bound">s</a>

  <a id="6557" class="Keyword">data</a> <a id="encoding.ArLvl"></a><a id="6562" href="present.html#6562" class="Datatype">ArLvl</a> <a id="6568" class="Symbol">{</a><a id="6569" href="present.html#6569" class="Bound">a</a><a id="6570" class="Symbol">}</a> <a id="6572" class="Symbol">(</a><a id="6573" href="present.html#6573" class="Bound">l</a> <a id="6575" class="Symbol">:</a> <a id="6577" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="6578" class="Symbol">)</a> <a id="6580" class="Symbol">(</a><a id="6581" href="present.html#6581" class="Bound">X</a> <a id="6583" class="Symbol">:</a> <a id="6585" class="PrimitiveType">Set</a> <a id="6589" href="present.html#6569" class="Bound">a</a><a id="6590" class="Symbol">)</a> <a id="6592" class="Symbol">(</a><a id="6593" href="present.html#6593" class="Bound">s</a> <a id="6595" class="Symbol">:</a> <a id="6597" href="present.html#6363" class="Function">ShType</a> <a id="6604" href="present.html#6573" class="Bound">l</a><a id="6605" class="Symbol">)</a> <a id="6607" class="Symbol">:</a> <a id="6609" class="PrimitiveType">Set</a> <a id="6613" href="present.html#6569" class="Bound">a</a> <a id="6615" class="Keyword">where</a>
    <a id="encoding.ArLvl.imap"></a><a id="6625" href="present.html#6625" class="InductiveConstructor">imap</a> <a id="6630" class="Symbol">:</a> <a id="6632" class="Symbol">(</a><a id="6633" href="present.html#6463" class="Record">IxLvl</a> <a id="6639" href="present.html#6573" class="Bound">l</a> <a id="6641" href="present.html#6593" class="Bound">s</a> <a id="6643" class="Symbol">→</a> <a id="6645" href="present.html#6581" class="Bound">X</a><a id="6646" class="Symbol">)</a> <a id="6648" class="Symbol">→</a> <a id="6650" href="present.html#6562" class="Datatype">ArLvl</a> <a id="6656" href="present.html#6573" class="Bound">l</a> <a id="6658" href="present.html#6581" class="Bound">X</a> <a id="6660" href="present.html#6593" class="Bound">s</a>
</pre>
</section>

<section id="encoding-1" class="title-slide slide level1">
<h1>Encoding</h1>
<pre class="Agda">  <a id="encoding.prod"></a><a id="6689" href="present.html#6689" class="Function">prod</a> <a id="6694" class="Symbol">:</a> <a id="6696" class="Symbol">∀</a> <a id="6698" class="Symbol">{</a><a id="6699" href="present.html#6699" class="Bound">l</a><a id="6700" class="Symbol">}</a> <a id="6702" class="Symbol">→</a> <a id="6704" href="present.html#6363" class="Function">ShType</a> <a id="6711" href="present.html#6699" class="Bound">l</a> <a id="6713" class="Symbol">→</a> <a id="6715" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>

  <a id="6720" href="present.html#6363" class="Function">ShType</a> <a id="6727" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a>    <a id="6735" class="Symbol">=</a> <a id="6737" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>
  <a id="6741" href="present.html#6363" class="Function">ShType</a> <a id="6748" class="Symbol">(</a><a id="6749" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="6753" href="present.html#6753" class="Bound">l</a><a id="6754" class="Symbol">)</a> <a id="6756" class="Symbol">=</a> <a id="6758" href="present.html#6424" class="Function">ReprAr</a> <a id="6765" href="present.html#6753" class="Bound">l</a> <a id="6767" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>

  <a id="6772" href="present.html#6424" class="Function">ReprAr</a> <a id="6779" href="present.html#6779" class="Bound">l</a> <a id="6781" href="present.html#6781" class="Bound">X</a> <a id="6783" class="Symbol">=</a> <a id="6785" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a> <a id="6787" class="Symbol">(</a><a id="6788" href="present.html#6363" class="Function">ShType</a> <a id="6795" href="present.html#6779" class="Bound">l</a><a id="6796" class="Symbol">)</a> <a id="6798" class="Symbol">λ</a> <a id="6800" href="present.html#6800" class="Bound">s</a> <a id="6802" class="Symbol">→</a> <a id="6804" href="Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="6808" href="present.html#6781" class="Bound">X</a> <a id="6810" class="Symbol">(</a><a id="6811" href="present.html#6689" class="Function">prod</a> <a id="6816" class="Symbol">{</a><a id="6817" class="Argument">l</a> <a id="6819" class="Symbol">=</a> <a id="6821" href="present.html#6779" class="Bound">l</a><a id="6822" class="Symbol">}</a> <a id="6824" href="present.html#6800" class="Bound">s</a><a id="6825" class="Symbol">)</a>

  <a id="6830" href="present.html#6388" class="Function">IxType</a> <a id="6837" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a> <a id="6842" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a> <a id="6845" class="Symbol">=</a> <a id="6847" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>
  <a id="6851" href="present.html#6388" class="Function">IxType</a> <a id="6858" class="Symbol">(</a><a id="6859" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="6863" href="present.html#6863" class="Bound">l</a><a id="6864" class="Symbol">)</a> <a id="6866" class="Symbol">(</a><a id="6867" href="present.html#6867" class="Bound">s</a> <a id="6869" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6871" href="present.html#6871" class="Bound">vec</a><a id="6874" class="Symbol">)</a> <a id="6876" class="Symbol">=</a> <a id="6878" href="present.html#1202" class="Datatype">Ix</a> <a id="6881" class="Symbol">(</a><a id="6882" href="present.html#6689" class="Function">prod</a> <a id="6887" href="present.html#6867" class="Bound">s</a><a id="6888" class="Symbol">)</a> <a id="6890" href="present.html#6871" class="Bound">vec</a>

  <a id="6897" href="present.html#6689" class="Function">prod</a> <a id="6902" class="Symbol">{</a><a id="6903" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="6907" class="Symbol">}</a>  <a id="6910" href="present.html#6910" class="Bound">sh</a> <a id="6913" class="Symbol">=</a> <a id="6915" class="Number">1</a>
  <a id="6919" href="present.html#6689" class="Function">prod</a> <a id="6924" class="Symbol">{</a><a id="6925" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="6929" href="present.html#6929" class="Bound">l</a><a id="6930" class="Symbol">}</a> <a id="6932" class="Symbol">(</a><a id="6933" href="present.html#6933" class="Bound">s</a> <a id="6935" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6937" href="present.html#6937" class="Bound">vec</a><a id="6940" class="Symbol">)</a> <a id="6942" class="Symbol">=</a> <a id="6944" href="Data.Vec.Base.html#4641" class="Function">foldr</a> <a id="6950" class="Symbol">_</a> <a id="6952" href="Agda.Builtin.Nat.html#501" class="Primitive Operator">_*_</a> <a id="6956" class="Number">1</a> <a id="6958" href="present.html#6937" class="Bound">vec</a>
</pre>
</section>

<section id="conclusions" class="title-slide slide level1">
<h1>Conclusions</h1>
<ul>
<li>Generalisation of multi-dimensional arrays
<ul>
<li>a hierarchy of array types with a very rich shape structure</li>
<li>level-polymorphic operations</li>
</ul></li>
<li>Discovered a novel container operation</li>
<li>Formalisation in Agda
<ul>
<li>found encoding for the hierarchy</li>
<li>implemented key array operations, e.g. reshape, flatten, ranked, etc</li>
<li>average pooling using generalised ranked operator</li>
<li>available at GitHub <a href="https://github.com/ashinkarov/agda-arrays-with-levels">ashinkarov/agda-arrays-with-levels</a></li>
</ul></li>
</ul>
<div class="fragment">
<p>Big thanks to Peter Hancock and Sven-Bodo Scholz for a number of very productive discussions.</p>
</div>
</section>
    </div>
  </div>

  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'linear', // none/fade/slide/convex/concave/zoom
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1200,
        height: 800,
        // Factor of the display size that should remain empty around the content
        margin: 0.2,

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
